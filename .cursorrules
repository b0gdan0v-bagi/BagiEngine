# BagiEngine - Cursor AI Rules

## Project Overview

BagiEngine is a C++23 game engine with modular architecture.

## Technology Stack

- **Language**: C++23
- **Build System**: CMake 3.31+ with Ninja
- **Graphics**: SDL3, ImGui
- **ECS**: EnTT
- **Containers**: EASTL (preferred over std::)
- **XML**: pugixml
- **Formatting**: fmt
- **Reflection**: magic_enum

## Project Structure

```
src/
├── Application/          # Application entry point
├── Widgets/              # Game widgets
└── Modules/
    ├── BECore/           # Core engine (see core-module.mdc)
    ├── Events/           # Event system (EnTT)
    ├── Math/             # Math utilities
    ├── TaskSystem/       # Async tasks (coroutines)
    └── SDL/              # SDL3 integration
config/                   # XML configuration files
```

## Code Style

### Naming
- **Classes/Methods**: PascalCase (`FileSystem`, `Initialize()`)
- **Variables**: camelCase (`virtualPath`)
- **Private members**: `_camelCase` (`_isRunning`)
- **Namespaces**: PascalCase (`BECore`)

### File Structure
```cpp
#pragma once

#include <...>  // External first
#include <BECore/...>  // Internal

namespace BECore {
    class MyClass : public Singleton<MyClass> {
    private:
        bool _flag = false;
    };
}  // namespace BECore
```

## Key Patterns

| Pattern | Usage |
|---------|-------|
| `Singleton<T>` | Global services |
| `PassKey<T>` | Access control |
| `RefCounted` + `IntrusivePtr` | Reference counting |
| `EventBase<T>` | Events (CRTP) |
| `IWidget` | UI/rendering |
| `CORE_ENUM(Name, Type, Values)` | Enums (not `enum class`) |

## Guidelines

### DO
- Use EASTL containers over std::
- Use `PoolString` for identifiers/keys
- Use `ASSERT` macro (not `std::assert`)
- Use `#pragma once`
- Add namespace closing comments
- Initialize members inline: `bool _flag = false;`
- Use `override` for virtual methods

### DON'T
- Don't use raw `new`/`delete` - use `IntrusivePtr`
- Don't use `std::string` when `PoolString` fits
- Don't use `enum class` - use `CORE_ENUM`
- Don't create circular dependencies
- Don't use C-style casts

## Module Dependencies

```
BECore → Math → Events → TaskSystem → SDL → Application
```

## Error Handling (No Exceptions)

- **Expected errors**: `std::expected<T, E>`
- **Programming errors**: `ASSERT()`
- **Critical errors**: `FATALERROR()`

## Planning

**CRITICAL**: For complex tasks:
- Save plans to `.cursor/plans/PLAN_NAME.md`
- Include testing and documentation tasks
- Update plan as work progresses
