---
description: Rules for Test system and Assertions
globs: 
  - src/Modules/BECore/Tests/**/*
  - src/Modules/BECore/Assert/**/*
  - config/TestsConfig.xml
  - config/AssertHandlersConfig.xml
alwaysApply: false
---

# Test System & Assertions

## Test System

Tests are managed by `TestManager` and run automatically in `CoreManager::OnApplicationPreInit()`.

### Adding a New Test

1. Create class in `BECore/Tests/` implementing `ITest`
2. Add `BE_CLASS(TestName)` macro inside class
3. Implement `TestCompileTime()` for compile-time checks
4. Enable in `config/TestsConfig.xml`

### Test Structure Pattern

| Element | Description |
|---------|-------------|
| `BE_CLASS(TestName)` | Macro inside class body |
| `bool Run() override` | Main test entry point |
| `static constexpr void TestCompileTime()` | Contains `static_assert` checks |
| `static_assert(ValidTest<TestName>)` | After class, validates test interface |

In `Run()`: call `TestCompileTime()` first, then runtime tests.

**Reference:** See `BECore/Tests/EnumUtilsTest.h` as example.

### ValidTest Concept

Validates that a test class has `Run()` returning `bool`, has `GetStaticTypeName()` from `BE_CLASS`, and inherits from `ITest`.

### Test Configuration

File: `config/TestsConfig.xml`
- Set `enabled="true/false"` to control which tests run
- Test types are auto-generated from `ITest` inheritance tree

## Assertion System

**Macros** (from `BECore/Assert/AssertMacros.h`):
- `ASSERT(expr)` / `ASSERT(expr, "msg")` — Critical check
- `EXPECT(expr)` / `EXPECT(expr, "msg")` — Soft expectation  
- `FATALERROR("msg")` — Unrecoverable error

**Key points:**
- Always use `ASSERT` instead of `std::assert`
- Use `static_assert` for compile-time checks in `TestCompileTime()`
- Assertions emit `AssertEvent` through event system
- Handlers configured via `config/AssertHandlersConfig.xml`

**Built-in handlers:**
- `DebugBreakHandler` — triggers debugger breakpoint
- `LogHandler` — logs assertion failures
- `AbortHandler` — calls abort()

## Checklist for New Test
- [ ] Inherit from `ITest`
- [ ] Add `BE_CLASS(TestName)`
- [ ] Implement `Run()` returning `bool`
- [ ] Add `static constexpr void TestCompileTime()` with `static_assert` checks
- [ ] Add `static_assert(ValidTest<TestName>)` after class
- [ ] Use `ASSERT` for runtime checks (not std::assert)
- [ ] Add to `TestsConfig.xml`
