---
description: Rules for Events module development
globs: src/Modules/Events/**/*
alwaysApply: false
---

# Events Module Guidelines

## Overview

Event system built on EnTT's dispatcher with CRTP-based static event types.

## Event Structure

Inherit from `EventBase<T>`:
- Simple event: `struct MyEvent { };`
- With data: Add fields + constructor

## Subscription API

| Method | Description |
|--------|-------------|
| `MyEvent::Subscribe<&Handler::OnEvent>(this)` | Manual subscription |
| `MyEvent::SubscribeScoped<&Handler::OnEvent>(this)` | Returns `scoped_connection` (RAII) |
| `MyEvent::Unsubscribe<&Handler>(instance)` | Unsubscribe specific handler |
| `MyEvent::UnsubscribeAll(instance)` | Unsubscribe all handlers for instance |

### SubscriptionHolder (RAII)

Inherit for automatic unsubscription:
- `Subscribe<EventType, &Handler>(this)` â€” auto-unsubscribes in destructor
- Preferred method for widget/component lifetime management

## Emitting API

| Method | Behavior |
|--------|----------|
| `MyEvent::Emit(args...)` | Immediate (synchronous) |
| `MyEvent::Enqueue(args...)` | Queued (processed during Update) |
| `MyEvent::Update()` | Process queued events |

## Event Categories

| File | Purpose |
|------|---------|
| `ApplicationEvents.h` | App lifecycle (Quit, CleanUp) |
| `RenderEvents.h` | Rendering (NewFrame, RenderPresent) |

## Best Practices

### DO
- Prefer `SubscriptionHolder` for automatic lifetime management
- Use `PoolString` for string data
- Keep events small (only necessary data)
- Prefer `Emit` over `Enqueue` unless deferred processing needed

### DON'T
- Store pointers to temporary objects in events
- Emit events from constructors
- Create circular event dependencies
- Connect/disconnect inside event handlers (undefined behavior)
- Forget to unsubscribe if not using `SubscriptionHolder`
